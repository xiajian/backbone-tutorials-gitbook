<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>SEO for single page applications | 介绍</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="../intermediate/organizing-backbone-using-modules.html" />
    
    
    <link rel="prev" href="../intermediate/real-time-backbone-with-pubnub.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="2.2"
        data-chapter-title="SEO for single page applications"
        data-filepath="intermediate/seo-for-single-page-apps.md"
        data-basepath=".."
        data-revision="Sat Apr 23 2016 21:50:51 GMT+0800 (CST)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" >
            
            <span><b>1.</b> Beginners</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="beginner/why-would-you-use-backbone.html">
            
                
                    <a href="../beginner/why-would-you-use-backbone.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Why would you use Backbone.js?
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="beginner/what-is-a-model.html">
            
                
                    <a href="../beginner/what-is-a-model.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        What is a model?
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="beginner/what-is-a-view.html">
            
                
                    <a href="../beginner/what-is-a-view.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                        What is a view?
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="beginner/what-is-a-router.html">
            
                
                    <a href="../beginner/what-is-a-router.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.4.</b>
                        
                        What is a router?
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="beginner/what-is-a-collection.html">
            
                
                    <a href="../beginner/what-is-a-collection.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.5.</b>
                        
                        What is a collection?
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" >
            
            <span><b>2.</b> Intermediate</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="intermediate/real-time-backbone-with-pubnub.html">
            
                
                    <a href="../intermediate/real-time-backbone-with-pubnub.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Real-Time Backbone With PubNub
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="2.2" data-path="intermediate/seo-for-single-page-apps.html">
            
                
                    <a href="../intermediate/seo-for-single-page-apps.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        SEO for single page applications
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="intermediate/organizing-backbone-using-modules.html">
            
                
                    <a href="../intermediate/organizing-backbone-using-modules.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        Organizing your application using Modules (require.js)
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="intermediate/cross-domain-sessions.html">
            
                
                    <a href="../intermediate/cross-domain-sessions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.4.</b>
                        
                        Cross-domain Backbone.js with sessions using CORS Lightweight
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="intermediate/infinite-scrolling.html">
            
                
                    <a href="../intermediate/infinite-scrolling.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.5.</b>
                        
                        Infinite Scrolling using Twitter API
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="intermediate/nodejs-restify-mongodb-mongoose.html">
            
                
                    <a href="../intermediate/nodejs-restify-mongodb-mongoose.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.6.</b>
                        
                        Simple example - Node.js, Restify, MongoDb and Mongoose
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >介绍</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="seo-for-single-page-apps">SEO for single page apps</h1>
<p>This tutorial will show you how to index your application on search engines.   As the author I believe that servers should be completely independent of the client in the age of API&apos;s.  Which speeds up development for the ever increasing array of clients.   It is on the shoulders of the search engines to conform and they should not dictate how the web is stored and accessed.</p>
<p>In 2009 Google released the idea of <a href="http://googlewebmastercentral.blogspot.com.au/2009/10/proposal-for-making-ajax-crawlable.html" target="_blank">escaped fragments</a>.   </p>
<p>The idea simply stating that if a search engine should come across your JavaScript application then you have the permission to redirect the search engine to another URL that serves the fully rendered version of the page (The current search engines cannot execute much JavaScript (Some people speculate that Google Chrome was born of Google Search wishing to successfully render every web page to retrieve ajaxed content)).</p>
<h2 id="how-does-redirecting-bots-work">How does redirecting bots work?</h2>
<p>Using modern headless browsers, we can easily return the fully rendered content per request by redirecting bots using our web servers configuration.   Here is an image made by Google depicting the setup.</p>
<p><img src="http://acris.googlecode.com/svn/wiki/images/seo_google_crawlability.png" alt="headless seo"></p>
<div style="clear: both;"></div>

<h2 id="implementation-using-phantomjs">Implementation using Phantom.js</h2>
<p><a href="http://phantomjs.org/" target="_blank">Phantom.js</a> is a headless webkit browser.  We are going to setup a node.js server that given a URL, it will fully render the page content. Then we will redirect bots to this server to retrieve the correct content.</p>
<p>You will need to install node.js and phantom.js onto a box. Then start up this server below. There are two files, one which is the web server and the other is a phantomjs script that renders the page.</p>
<pre><code class="lang-js"><span class="hljs-comment">// web.js</span>

<span class="hljs-comment">// Express is our web server that can handle request</span>
<span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;express&apos;</span>);
<span class="hljs-keyword">var</span> app = express();


<span class="hljs-keyword">var</span> getContent = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">url, callback</span>) </span>{
  <span class="hljs-keyword">var</span> content = <span class="hljs-string">&apos;&apos;</span>;
  <span class="hljs-comment">// Here we spawn a phantom.js process, the first element of the </span>
  <span class="hljs-comment">// array is our phantomjs script and the second element is our url </span>
  <span class="hljs-keyword">var</span> phantom = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;child_process&apos;</span>).spawn(<span class="hljs-string">&apos;phantomjs&apos;</span>, [<span class="hljs-string">&apos;phantom-server.js&apos;</span>, url]);
  phantom.stdout.setEncoding(<span class="hljs-string">&apos;utf8&apos;</span>);
  <span class="hljs-comment">// Our phantom.js script is simply logging the output and</span>
  <span class="hljs-comment">// we access it here through stdout</span>
  phantom.stdout.on(<span class="hljs-string">&apos;data&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
    content += data.toString();
  });
  phantom.on(<span class="hljs-string">&apos;exit&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">code</span>) </span>{
    <span class="hljs-keyword">if</span> (code !== <span class="hljs-number">0</span>) {
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;We have an error&apos;</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// once our phantom.js script exits, let&apos;s call out call back</span>
      <span class="hljs-comment">// which outputs the contents to the page</span>
      callback(content);
    }
  });
};

<span class="hljs-keyword">var</span> respond = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>{
  <span class="hljs-comment">// Because we use [P] in htaccess we have access to this header</span>
  url = <span class="hljs-string">&apos;http://&apos;</span> + req.headers[<span class="hljs-string">&apos;x-forwarded-host&apos;</span>] + req.params[<span class="hljs-number">0</span>];
  getContent(url, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">content</span>) </span>{
    res.send(content);
  });
}

app.get(<span class="hljs-regexp">/(.*)/</span>, respond);
app.listen(<span class="hljs-number">3000</span>);
</code></pre>
<p>The script below is <code>phantom-server.js</code> and will be in charge of fully rendering the content. We don&apos;t return the content  until the page is fully rendered. We hook into the resources listener to do this.</p>
<pre><code>var page = require(&apos;webpage&apos;).create();
var system = require(&apos;system&apos;);

var lastReceived = new Date().getTime();
var requestCount = 0;
var responseCount = 0;
var requestIds = [];
var startTime = new Date().getTime();

page.onResourceReceived = function (response) {
    if(requestIds.indexOf(response.id) !== -1) {
        lastReceived = new Date().getTime();
        responseCount++;
        requestIds[requestIds.indexOf(response.id)] = null;
    }
};
page.onResourceRequested = function (request) {
    if(requestIds.indexOf(request.id) === -1) {
        requestIds.push(request.id);
        requestCount++;
    }
};

// Open the page
page.open(system.args[1], function () {});

var checkComplete = function () {
  // We don&apos;t allow it to take longer than 5 seconds but
  // don&apos;t return until all requests are finished
  if((new Date().getTime() - lastReceived &gt; 300 &amp;&amp; requestCount === responseCount) || new Date().getTime() - startTime &gt; 5000)  {
    clearInterval(checkCompleteInterval);
    console.log(page.content);
    phantom.exit();
  }
}
// Let us check to see if the page is finished rendering
var checkCompleteInterval = setInterval(checkComplete, 1);
</code></pre><p>Once we have this server up and running we just redirect bots to the server in our client&apos;s web server configuration.</p>
<h2 id="redirecting-bots">Redirecting bots</h2>
<p>If you are using apache we can edit out <code>.htaccess</code> such that Google requests are proxied to our middle man phantom.js server.</p>
<pre><code>RewriteEngine on
RewriteCond %{QUERY_STRING} ^_escaped_fragment_=(.*)$
RewriteRule (.*) http://webserver:3000/%1? [P]
</code></pre><p>We could also include other <code>RewriteCond</code>, such as <code>user agent</code> to redirect other search engines we wish to be indexed on.</p>
<p>Though Google won&apos;t use <code>_escaped_fragment_</code> unless we tell it to by either including a meta tag;
<code>&lt;meta name=&quot;fragment&quot; content=&quot;!&quot;&gt;</code>
or
using <code>#!</code> URLs in our links.</p>
<p>You will most likely have to use both.</p>
<p>I have released an open source npm package called <a href="http://seo.apiengine.io" target="_blank">seo server</a> for anyone wanting to jump straight in.</p>
<p>This has been tested with Google Webmasters fetch tool.  Make sure you include <code>#!</code> on your URLs when using the fetch tool.</p>
<h3 id="relevant-links">Relevant Links</h3>
<ul>
<li><a href="http://seo.apiengine.io" target="_blank">Open source node.js Seo Server</a></li>
</ul>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../intermediate/real-time-backbone-with-pubnub.html" class="navigation navigation-prev " aria-label="Previous page: Real-Time Backbone With PubNub"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../intermediate/organizing-backbone-using-modules.html" class="navigation navigation-next " aria-label="Next page: Organizing your application using Modules (require.js)"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
